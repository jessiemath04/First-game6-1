<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Jessie Math - æœªä¾†é™¤æ³•å¯¦é©—å®¤</title>

  <!-- âœ… å¿«å–é€£çµé è¦½ï¼ˆè«‹æ”¾åœ¨ <head> è£¡ï¼‰ -->
  <meta name="description" content="Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.">
  <!-- âœ… LINE / FB é è¦½ç”¨ -->
  <meta property="og:title" content="Jessie Math - æœªä¾†é™¤æ³•å¯¦é©—å®¤">
  <meta property="og:description" content="Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.">
  <meta property="og:type" content="website">

  <!-- âœ… é è¦½åœ–ç‰‡ -->
  <meta property="og:image" content="g4-u6-1.png">
  <meta property="og:image:width" content="1024">
  <meta property="og:image:height" content="1536">
  <meta property="og:image:alt" content="Jessie Math éŠæˆ²å°é¢">

  <!-- âœ… æœ‰äº›å¹³å°æœƒåƒè€ƒ -->
  <link rel="image_src" href="g4-u6-1.png">

  <!-- âœ… Twitter / Xï¼ˆå¯ç”¨åŒä¸€å¼µåœ–ï¼‰ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Jessie Math - æœªä¾†é™¤æ³•å¯¦é©—å®¤">
  <meta name="twitter:description" content="Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.">
  <meta name="twitter:image" content="g4-u6-1.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <style>
    :root{
      --bg:#eef6ff;
      --dot:#b9d7ff;

      --card:#ffffff;
      --line:#dbeafe;

      --ink:#0f172a;
      --muted:#64748b;

      --brand:#2563eb;
      --brand-2:#7c3aed;
      --good:#16a34a;
      --bad:#ef4444;

      --radius-lg: 26px;
      --radius-sm: 14px;
      --shadow: 0 18px 40px rgba(15, 23, 42, 0.10);
      --shadow-soft: 0 10px 26px rgba(15, 23, 42, 0.08);

      --font-main:'Inter','Noto Sans TC',sans-serif;

      /* footer tokens */
      --footer-bg: rgba(255,255,255,0.92);
      --footer-border: rgba(15,23,42,0.08);
      --footer-dot: #22c55e;

      /* topbar brand ring */
      --ring: #fb923c;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }

    body{
      font-family: var(--font-main);
      color: var(--ink);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding: 18px 14px 28px;
      line-height:1.6;
      background:
        radial-gradient(circle, rgba(185,215,255,.55) 1.2px, transparent 1.2px) 0 0 / 22px 22px,
        linear-gradient(#ffffff, #ffffff) 0 0 / 100% 68px no-repeat,
        linear-gradient(var(--bg), var(--bg));
    }

    .page{
      width:100%;
      max-width: 1180px;
      background: transparent;
      display:flex;
      flex-direction:column;
      gap: 18px;
    }

    /* =========================
       HERO / TOPBARï¼ˆå°é½Šåƒè€ƒåœ–ï¼‰
       ========================= */
    .topbar{
      background:#fff;
      border:1px solid rgba(15, 23, 42, 0.06);
      border-radius: 18px;
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow: var(--shadow-soft);
      gap: 14px;
    }

    .brand-left{
      display:flex;
      align-items:center;
      gap: 12px;
      min-width: 220px;
    }

    /* å·¦ä¸Šè§’ï¼šé»ƒåœˆ + é€æ˜åº• + åœ–ç‰‡ */
    .logo-circle{
      width: 44px;
      height: 44px;
      border-radius: 999px;
      background: transparent;
      border: 3px solid var(--ring);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      box-shadow: 0 10px 22px rgba(251,146,60,0.15);
      flex: 0 0 auto;
    }
    .logo-circle img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display:block;
      background: transparent;
    }

    /* åªç•™ Jessie Mathï¼ˆä¸‹é¢é‚£è¡Œä¸è¦ï¼‰ */
    .brand-text-main .en{
      font-weight: 800;
      letter-spacing: .2px;
      font-size: 1.25rem;
      display:block;
      color: var(--ink);
      line-height: 1.15;
    }
    .brand-text-main .tw{ display:none; }

    .nav-links{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .nav-btn{
      text-decoration:none;
      color: var(--ink);
      font-size: .85rem;
      padding: 10px 14px;
      border-radius: 12px;
      border:1px solid rgba(15, 23, 42, 0.08);
      background: #fff;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      transition: .2s ease;
      box-shadow: 0 6px 16px rgba(15,23,42,0.06);
      cursor:pointer;
      white-space: nowrap;
    }
    .nav-btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(15,23,42,0.10);
    }

    /* å³ä¸Šè§’ç¬¬ä¸‰é¡†ï¼šå›åˆ°å››å¹´ç´šé™¤æ³•ï¼ˆç´«è‰²å¤–æ¡†æ„Ÿï¼‰ */
    .nav-btn.primary{
      color: var(--brand-2);
      border-color: rgba(124,58,237,0.22);
      background: rgba(124,58,237,0.06);
    }

    .screens{ min-height: 560px; display:flex; justify-content:center; }
    .screen{ display:none; width:100%; }
    .screen.active{ display:block; animation: popIn .35s cubic-bezier(.16,1,.3,1); }
    @keyframes popIn{
      from{ opacity:0; transform: translateY(12px) scale(.99); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    .card{
      background: var(--card);
      border: 1px solid rgba(15, 23, 42, 0.06);
      border-radius: var(--radius-lg);
      padding: 26px;
      box-shadow: var(--shadow);
      max-width: 680px;
      margin: 0 auto;
    }

    .tag{
      font-size: .75rem;
      letter-spacing: 2px;
      color: var(--brand);
      font-weight: 800;
      display:block;
      margin-bottom: 8px;
    }

    .card-title{
      font-size: 2.2rem;
      font-weight: 900;
      letter-spacing: .2px;
      text-align:center;
      margin-top: 6px;
      margin-bottom: 6px;
    }

    .desc{
      color: var(--muted);
      font-size: .95rem;
      text-align:center;
      margin-bottom: 18px;
    }

    .primary-btn{
      width: 100%;
      justify-content:center;
      background: var(--brand);
      border: 1px solid rgba(37,99,235,0.25);
      color:#fff;
      padding: 14px 16px;
      border-radius: 14px;
      cursor:pointer;
      font-size: 1.05rem;
      font-weight: 900;
      display:inline-flex;
      align-items:center;
      gap: 10px;
      transition: .2s ease;
      box-shadow: 0 14px 28px rgba(37,99,235,0.20);
    }
    .primary-btn:hover{ transform: translateY(-1px); box-shadow: 0 18px 34px rgba(37,99,235,0.26); }

    .name-input{
      width:100%;
      padding: 14px 16px;
      border-radius: 14px;
      border: 2px solid rgba(37,99,235,0.18);
      background: #fff;
      outline:none;
      font-size: 1rem;
      margin-top: 10px;
    }
    .name-input:focus{ border-color: rgba(37,99,235,0.45); }

    .menu-grid{
      display:grid;
      grid-template-columns: 2fr 1fr;
      gap: 18px;
      max-width: 980px;
      margin: 0 auto;
      width: 100%;
    }

    .card.small{
      max-width: none;
      margin: 0;
      padding: 22px;
      border-radius: 22px;
      box-shadow: var(--shadow-soft);
    }

    .level-bar{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .level-btn{
      background: #fff;
      border: 1px solid rgba(15,23,42,0.08);
      border-radius: 16px;
      padding: 14px 14px;
      text-align:left;
      cursor:pointer;
      transition: .2s ease;
      box-shadow: 0 8px 18px rgba(15,23,42,0.06);
    }
    .level-btn:hover{ transform: translateY(-1px); }
    .level-btn.active{
      outline: 3px solid rgba(37,99,235,0.22);
      border-color: rgba(37,99,235,0.35);
      background: rgba(37,99,235,0.05);
    }
    .level-btn .lid{ font-size:.78rem; color: var(--muted); font-weight:800; }
    .level-btn .lname{ font-size: 1.02rem; font-weight: 900; margin-top: 2px; display:block; }
    .level-btn .lhint{ font-size:.82rem; color: var(--muted); }

    .chip-row{ display:flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
    .chip-btn{
      background:#fff;
      border: 1px solid rgba(15,23,42,0.10);
      color: var(--muted);
      padding: 8px 14px;
      border-radius: 999px;
      font-size: .85rem;
      font-weight: 900;
      cursor:pointer;
      transition:.2s ease;
    }
    .chip-btn.active{
      background: rgba(22,163,74,0.10);
      border-color: rgba(22,163,74,0.28);
      color: #166534;
    }
    .chip-btn.speed.active{
      background: rgba(37,99,235,0.10);
      border-color: rgba(37,99,235,0.25);
      color: var(--brand);
    }
    .chip-btn.hard.active{
      background: rgba(124,58,237,0.10);
      border-color: rgba(124,58,237,0.25);
      color: var(--brand-2);
    }

    .rank-list{ list-style:none; margin-top: 10px; }
    .rank-list li{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(15,23,42,0.06);
      font-size: .92rem;
      color: var(--ink);
      gap: 12px;
    }
    .rank-list li span:first-child{
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 72%;
    }

    .game-shell{
      max-width: 860px;
      margin: 0 auto;
      width: 100%;
      position: relative;
    }

    .game-header{
      display:flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .stat-chip{
      background: #fff;
      border: 1px solid rgba(15,23,42,0.10);
      padding: 10px 14px;
      border-radius: 999px;
      font-size: .9rem;
      display:flex;
      align-items:center;
      gap: 10px;
      box-shadow: 0 10px 22px rgba(15,23,42,0.06);
    }
    .stat-chip .label{ color: var(--muted); font-weight: 900; font-size: .78rem; letter-spacing: 1px; }
    .stat-chip .value{ font-weight: 900; color: var(--brand); }

    .question-card{
      background: #fff;
      border: 1px solid rgba(15,23,42,0.06);
      border-radius: 26px;
      padding: 26px;
      box-shadow: var(--shadow);
      text-align:center;
      position: relative;
    }

    .story-row{
      display:flex;
      gap: 12px;
      align-items:flex-start;
      background: rgba(37,99,235,0.06);
      border: 1px solid rgba(37,99,235,0.14);
      padding: 16px 16px;
      border-radius: 18px;
      margin-bottom: 16px;
      text-align:left;
    }
    .story-icon{
      font-size: 1.5rem;
      color: var(--brand);
      flex: 0 0 auto;
      margin-top: 2px;
    }
    .story-text{
      font-size: 1.05rem;
      color: var(--ink);
      font-weight: 800;
      line-height: 1.55;
    }

    /* âœ… ä¸é¡¯ç¤ºå…§å»ºç®—å¼ï¼ˆç©å®¶è‡ªå·±å¡«ï¼‰ */
    .question-main{ display:none; }

    .stock-bar{
      width:100%;
      height: 6px;
      background: rgba(15,23,42,0.06);
      border-radius: 999px;
      overflow:hidden;
      margin: 14px 0 8px;
    }
    .stock-fill{
      height:100%;
      width:100%;
      background: var(--brand);
      transition: width .55s cubic-bezier(.34,1.56,.64,1);
      box-shadow: 0 0 12px rgba(37,99,235,0.25);
    }

    .guess-row{ display:flex; justify-content:center; margin-top: 18px; }
    .guess-box{
      background: #fff;
      border: 2px solid rgba(37,99,235,0.18);
      border-radius: 16px;
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 10px 14px;
      box-shadow: 0 10px 22px rgba(15,23,42,0.06);
      width: min(520px, 100%);
      justify-content: center;
    }
    .guess-btn{
      background: rgba(37,99,235,0.06);
      border: 1px solid rgba(37,99,235,0.14);
      width: 38px;
      height: 38px;
      border-radius: 12px;
      cursor:pointer;
      color: var(--brand);
      display:flex;
      align-items:center;
      justify-content:center;
      transition:.15s ease;
      flex: 0 0 auto;
    }
    .guess-btn:hover{ transform: translateY(-1px); }

    .guess-input{
      width: 120px;
      border:none;
      outline:none;
      font-size: 1.35rem;
      font-weight: 900;
      text-align:center;
      color: var(--ink);
      background: transparent;
    }

    .blank-row{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 4px;
      margin-bottom: 6px;
    }
    .blank-op{
      font-weight: 900;
      font-size: 1.2rem;
      color: var(--muted);
      padding: 0 2px;
    }
    .blank-input{
      width: 150px;
      max-width: 42vw;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(37,99,235,0.06);
      border: 2px solid rgba(37,99,235,0.18);
      color: var(--ink);
      font-weight: 900;
      font-size: 1.05rem;
      text-align:center;
      outline: none;
      box-shadow: 0 10px 22px rgba(15,23,42,0.05);
    }
    .blank-input:focus{
      border-color: rgba(37,99,235,0.45);
      background: rgba(37,99,235,0.08);
    }
    .blank-hint{
      margin-top: 6px;
      font-weight: 900;
      color: var(--muted);
      font-size: .95rem;
    }

    .feedback{
      margin-top: 12px;
      min-height: 2.0em;
      font-weight: 900;
      line-height: 1.4;
    }
    .feedback .good{ color: var(--good); }
    .feedback .bad{ color: var(--bad); }
    .feedback .ans{ color: var(--ink); font-weight: 900; }

    .action-row{
      display:flex;
      gap: 10px;
      justify-content:center;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    .action-row .nav-btn{
      padding: 12px 14px;
      font-weight: 900;
    }
    .sub-actions{
      display:flex;
      gap: 10px;
      margin-top: 12px;
      justify-content:flex-end;
      flex-wrap: wrap;
    }

    .mini{
      font-size: .86rem;
      color: var(--muted);
      font-weight: 800;
    }

    .pause-overlay{
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,0.75);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 26px;
      border: 1px solid rgba(15,23,42,0.06);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
      box-shadow: var(--shadow);
    }
    .pause-overlay.active{ display:flex; }
    .pause-box{
      background:#fff;
      border: 1px solid rgba(15,23,42,0.08);
      border-radius: 18px;
      padding: 18px 18px;
      width: min(420px, 92%);
      text-align:center;
      box-shadow: 0 14px 28px rgba(15,23,42,0.10);
    }
    .pause-box .t{
      font-weight: 900;
      font-size: 1.15rem;
      margin-bottom: 6px;
      color: var(--ink);
    }
    .pause-box .d{
      color: var(--muted);
      font-weight: 800;
      font-size: .92rem;
      margin-bottom: 12px;
    }
    .pause-box .primary-btn{
      width: 100%;
      padding: 12px 14px;
      font-size: 1rem;
    }

    /* âœ… è¦å‰‡å½ˆçª—ï¼ˆåªæ–°å¢ï¼Œä¸å‹•åŸæœ¬çµæ§‹ï¼‰ */
    .modal-backdrop{
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.35);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 16px;
    }
    .modal-backdrop.active{ display:flex; }
    .modal{
      width: min(720px, 96vw);
      background: #fff;
      border: 1px solid rgba(15,23,42,0.10);
      border-radius: 22px;
      box-shadow: 0 22px 60px rgba(15,23,42,0.22);
      overflow: hidden;
    }
    .modal-head{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 14px 16px;
      background: linear-gradient(90deg, rgba(37,99,235,0.10), rgba(124,58,237,0.08));
      border-bottom: 1px solid rgba(15,23,42,0.06);
    }
    .modal-title{
      font-weight: 900;
      color: var(--ink);
      letter-spacing: .2px;
      display:flex;
      align-items:center;
      gap: 10px;
    }
    .modal-close{
      border: 1px solid rgba(15,23,42,0.10);
      background: #fff;
      border-radius: 12px;
      width: 40px;
      height: 40px;
      cursor: pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 10px 22px rgba(15,23,42,0.06);
      transition:.15s ease;
    }
    .modal-close:hover{ transform: translateY(-1px); }
    .modal-body{
      padding: 16px 18px 18px;
      color: var(--ink);
    }
    .rule-block{
      border: 1px solid rgba(15,23,42,0.06);
      background: rgba(37,99,235,0.04);
      border-radius: 18px;
      padding: 14px 14px;
      margin-top: 12px;
    }
    .rule-h{
      font-weight: 900;
      color: var(--brand);
      letter-spacing: .2px;
      display:flex;
      align-items:center;
      gap: 10px;
      margin-bottom: 8px;
    }
    .rule-ul{
      margin-left: 18px;
      color: var(--ink);
      font-weight: 700;
    }
    .rule-ul li{ margin: 6px 0; }
    .rule-note{
      margin-top: 10px;
      color: var(--muted);
      font-weight: 800;
      font-size: .92rem;
      line-height: 1.55;
    }

    @media(max-width: 980px){
      .menu-grid{ grid-template-columns: 1fr; }
      .card{ max-width: 760px; }
      .game-shell{ max-width: 760px; }
    }

    @media(max-width: 600px){
      body{ padding: 14px 10px 22px; background-size: 18px 18px, 100% 64px, auto; }
      .topbar{ padding: 12px 12px; border-radius: 16px; }
      .brand-left{ min-width: 0; }
      .brand-text-main .en{ font-size: 1.05rem; }
      .card{ padding: 18px; border-radius: 22px; }
      .card-title{ font-size: 1.8rem; }
      .desc{ font-size: .92rem; }
      .level-bar{ grid-template-columns: 1fr; }
      .question-card{ padding: 18px; border-radius: 22px; }

      .story-row{ padding: 14px 14px; border-radius: 16px; }
      .story-icon{ font-size: 1.35rem; }
      .story-text{ font-size: 1.0rem; }

      .blank-input{ width: 140px; max-width: 44vw; font-size: 1.0rem; }

      .nav-btn{ padding: 10px 12px; }
      .primary-btn{ padding: 13px 14px; font-size: 1rem; }
      .pause-overlay{ border-radius: 22px; }
    }

    @media(min-width: 1280px){
      .page{ max-width: 1280px; }
    }

    /* Footer */
    footer{ margin-top: 6px; }
    .footer-pill{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      background: var(--footer-bg);
      border: 1px solid var(--footer-border);
      border-radius: 999px;
      padding: 10px 14px;
      box-shadow: var(--shadow-soft);
      max-width: 1180px;
      margin: 0 auto;
    }
    .footer-left, .footer-right{
      display:flex;
      align-items:center;
      gap: 10px;
      min-width: 200px;
    }
    .footer-dot{
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--footer-dot);
      box-shadow: 0 0 0 4px rgba(34,197,94,0.15);
      flex: 0 0 auto;
    }
    .footer-copy{
      font-size: .85rem;
      color: var(--muted);
      font-weight: 800;
      letter-spacing: .2px;
    }
    .footer-icon{
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: rgba(37,99,235,0.08);
      border: 1px solid rgba(37,99,235,0.14);
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--brand);
      flex: 0 0 auto;
    }
    .footer-tagline{
      font-size: .9rem;
      font-weight: 900;
      color: var(--ink);
    }
  </style>
</head>

<body>
  <div class="page">
    <header class="topbar">
      <div class="brand-left">
        <div class="logo-circle" aria-label="Jessie Math Logo">
          <img src="JESSIEMATH-Q.png" alt="Jessie Math" />
        </div>
        <div class="brand-text-main">
          <span class="en">Jessie Math</span>
        </div>
      </div>

      <nav class="nav-links">
        <a class="nav-btn" href="https://jessiemath0703-chu.github.io/website2/" target="_blank" rel="noopener">
          <i class="fa-solid fa-house"></i>é¦–é 
        </a>
        <a class="nav-btn" href="https://jessiemath0703-chu.github.io/Game-Lobby/" target="_blank" rel="noopener">
          <i class="fa-solid fa-gamepad"></i>éŠæˆ²å¤§å»³
        </a>
        <a class="nav-btn primary" href="https://jessiemath0703-chu.github.io/Game-Lobby/#g4-u6" target="_blank" rel="noopener">
          <i class="fa-solid fa-rotate-left"></i>å››å¹´ç´šé™¤æ³•
        </a>
      </nav>
    </header>

    <main class="screens">

      <section class="screen active" id="screen-welcome">
        <div class="card">
          <span class="tag">é‹ç®—æ¢éšªå®¶</span>
          <h2 class="card-title">æ•¸æ“šé™¤æ³•æ¨¡æ“¬å™¨</h2>
          <p class="desc">æŒ‘æˆ°é™¤æ³•ã€åˆ†é…ã€æ­¥é©Ÿèˆ‡ç”Ÿæ´»æ‡‰ç”¨é¡Œã€‚è¼¸å…¥åå­—å¾Œï¼Œé–‹å•Ÿä½ çš„æ¢éšªã€‚</p>

          <div style="margin: 10px 0 14px;">
            <input id="welcomeNameInput" class="name-input" placeholder="è«‹è¼¸å…¥ä½ çš„åå­—" />
            <div id="welcomeHint" style="font-size: 0.85rem; color: var(--bad); margin-top: 8px; font-weight: 900;"></div>
          </div>

          <button class="primary-btn" id="goMenuBtn">
            <span>é–‹å§‹æ¢éšª</span>
            <i class="fa-solid fa-arrow-right"></i>
          </button>
        </div>
      </section>

      <section class="screen" id="screen-menu">
        <div class="menu-grid">
          <div class="card small">
            <span class="tag">é¸æ“‡é—œå¡</span>
            <div style="display:flex; align-items:flex-end; justify-content:space-between; gap:10px; flex-wrap:wrap;">
              <div>
                <div class="mini">ä½ å¥½ï¼Œé‹ç®—æ¢éšªå®¶</div>
                <div id="playerNameTitle" style="font-size: 1.6rem; font-weight: 900; color: var(--brand); margin-top: 2px;">---</div>
              </div>
              <!-- âœ… è¦å‰‡æŒ‰éˆ•ï¼šæ”¹æˆå¯é–‹å•Ÿå½ˆçª—ï¼ˆå…¶é¤˜ä¸å‹•ï¼‰ -->
              <a class="nav-btn" href="#" id="ruleBtn" style="padding:10px 12px;">
                <i class="fa-solid fa-circle-info"></i>è¦å‰‡
              </a>
            </div>

            <div class="chip-row" style="margin-top: 14px;">
              <button class="chip-btn active" data-diff="easy" id="diffEasy">æ™®é€š</button>
              <button class="chip-btn hard" data-diff="hard" id="diffHard">å›°é›£ï¼ˆåˆ†æ•¸x1.5ï¼‰</button>
            </div>

            <div class="level-bar" style="margin-top: 14px;">
              <button class="level-btn active" data-level="1">
                <span class="lid">6-1</span>
                <span class="lname">æ­¥é©Ÿè¿·å®®</span>
                <span class="lhint">å››ä½æ•¸ Ã· ä¸€ä½æ•¸</span>
              </button>
              <button class="level-btn" data-level="2">
                <span class="lid">6-2</span>
                <span class="lname">åˆ†é…å¾‹å·¥å» </span>
                <span class="lhint">äºŒä½æ•¸ Ã· äºŒä½æ•¸</span>
              </button>
              <button class="level-btn" data-level="3">
                <span class="lid">6-3</span>
                <span class="lname">é€£é™¤æŒ‘æˆ°</span>
                <span class="lhint">ä¸‰ä½æ•¸ Ã· äºŒä½æ•¸</span>
              </button>
              <button class="level-btn" data-level="4">
                <span class="lid">6-4</span>
                <span class="lname">ç”Ÿæ´»æ‡‰ç”¨å®¶</span>
                <span class="lhint">10, 100 ä½å€¼è½‰æ›</span>
              </button>
            </div>

            <div style="margin-top: 14px;">
              <span class="tag" style="margin-bottom:6px;">æ™‚é–“è¨­å®š</span>
              <div class="chip-row" id="speedChips">
                <button class="chip-btn speed active" data-speed="slow">120s</button>
                <button class="chip-btn speed" data-speed="normal">90s</button>
                <button class="chip-btn speed" data-speed="fast">60s</button>
              </div>
            </div>

            <p id="menuSummary" style="margin-top: 14px; color: var(--muted); font-weight: 900;"></p>

            <button class="primary-btn" id="startPlayBtn" style="margin-top: 14px;">
              <span>é–‹å§‹æ¢éšª</span>
              <i class="fa-solid fa-play"></i>
            </button>
          </div>

          <div class="card small">
            <span class="tag">å†’éšªè€…æ’è¡Œ</span>
            <ul class="rank-list" id="rankList">
              <li><span>æš«ç„¡ç´€éŒ„ï¼Œå¿«ä¾†æŒ‘æˆ°ï¼</span><span>---</span></li>
            </ul>
          </div>
        </div>
      </section>

      <section class="screen" id="screen-game">
        <div class="game-shell">
          <div class="game-header">
            <div>
              <div id="gameLevelTitle" style="font-size: 1.15rem; font-weight: 900; color: var(--ink);">PROTOCOL</div>
              <div id="gameLevelTag" class="mini" style="margin-top: 2px;">---</div>
            </div>

            <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
              <div class="stat-chip">
                <span class="label">TIME</span>
                <span class="value" id="gameTimerText">--</span>
              </div>
              <div class="stat-chip">
                <span class="label">SCORE</span>
                <span class="value" id="gameScoreText">0</span>
              </div>
            </div>
          </div>

          <div class="question-card" id="questionCard">
            <div class="pause-overlay" id="pauseOverlay" aria-hidden="true">
              <div class="pause-box">
                <div class="t">å·²æš«åœ</div>
                <div class="d">é¡Œç›®å·²é®è”½ï¼Œå…¬å¹³æ¨¡å¼å•Ÿå‹•ã€‚</div>
                <button class="primary-btn" id="resumeBtn">
                  <span>æ¢å¾©</span>
                  <i class="fa-solid fa-play"></i>
                </button>
              </div>
            </div>

            <div class="story-row">
              <div class="story-icon" id="storyIcon"><i class="fa-solid fa-microchip"></i></div>
              <div class="story-text" id="storyText">æ•¸æ“šè¼‰å…¥ä¸­...</div>
            </div>

            <div class="blank-row" aria-label="è«‹è¼¸å…¥è¢«é™¤æ•¸èˆ‡é™¤æ•¸">
              <input id="blankAInput" class="blank-input" type="number" inputmode="numeric" placeholder="è¢«é™¤æ•¸" />
              <span class="blank-op">Ã·</span>
              <input id="blankBInput" class="blank-input" type="number" inputmode="numeric" placeholder="é™¤æ•¸" />
            </div>
            <div class="blank-hint" id="blankHint">è«‹æ ¹æ“šé¡Œç›®æ•˜è¿°ï¼Œè¼¸å…¥è¢«é™¤æ•¸å’Œé™¤æ•¸ã€‚</div>

            <div class="question-main" id="exprMain">0 Ã· 0 = ?</div>

            <div class="stock-bar">
              <div class="stock-fill" id="stockFill"></div>
            </div>
            <div style="display:flex; justify-content:space-between; font-size:.85rem; color: var(--muted); font-weight:900;">
              <span id="stockTitle">REMAINING DATA</span>
              <span id="stockText">100%</span>
            </div>

            <div class="guess-row">
              <div class="guess-box">
                <button class="guess-btn" id="minusBtn"><i class="fa-solid fa-minus"></i></button>
                <input id="guessInput" class="guess-input" type="number" placeholder="ç­”æ¡ˆ" />
                <button class="guess-btn" id="plusBtn"><i class="fa-solid fa-plus"></i></button>
              </div>
            </div>

            <div class="feedback" id="feedbackBox"></div>

            <div class="action-row">
              <button class="primary-btn" id="checkBtn" style="width:auto; min-width: 180px; padding: 12px 16px;">
                æäº¤
                <i class="fa-solid fa-check"></i>
              </button>
              <!-- âœ… è·³éæŒ‰éˆ•å·²åˆªé™¤ -->
            </div>
          </div>

          <div class="sub-actions">
            <button class="nav-btn" id="pauseBtn">æš«åœ</button>
            <button class="nav-btn" id="retryTopBtn">é‡æ–°</button>
            <button class="nav-btn" id="backMenuBtn">è¿”å›</button>
          </div>

          <div id="timeupText" style="text-align:center; color: var(--bad); font-weight: 900; margin-top: 10px;"></div>
        </div>
      </section>

    </main>

    <!-- âœ… Footer åŠ å…¥ -->
    <footer>
      <div class="footer-pill">
        <div class="footer-left">
          <div class="footer-dot" aria-hidden="true"></div>
          <div class="footer-copy">Â© 2025â€“2026 Jessie Math æ·æè€å¸«. All rights reserved.</div>
        </div>
        <div class="footer-right">
          <div class="footer-icon" aria-hidden="true"><i class="fas fa-compass"></i></div>
          <div class="footer-tagline">æ•¸å­¸ä¸è¿·è·¯ï¼ŒJessie å¸¶ä½ èµ°å‘ç†è§£ã€‚</div>
        </div>
      </div>
    </footer>
  </div>

  <!-- âœ… è¦å‰‡å½ˆçª— -->
  <div class="modal-backdrop" id="ruleModal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="ruleTitle">
      <div class="modal-head">
        <div class="modal-title" id="ruleTitle">
          <i class="fa-solid fa-scroll"></i>
          éŠæˆ²è¦å‰‡èˆ‡èªªæ˜
        </div>
        <button class="modal-close" id="ruleCloseBtn" aria-label="é—œé–‰">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="rule-block">
          <div class="rule-h"><i class="fa-solid fa-gamepad"></i>éŠæˆ²è¦å‰‡</div>
          <ul class="rule-ul">
            <li>æ¯é¡Œæœƒçµ¦ä½ ä¸€æ®µæƒ…å¢ƒæ•˜è¿°ï¼Œä½ è¦å…ˆå¡«ã€Œè¢«é™¤æ•¸ã€èˆ‡ã€Œé™¤æ•¸ã€ï¼Œå†è¼¸å…¥ã€Œç­”æ¡ˆã€ã€‚</li>
            <li>ã€Œè¢«é™¤æ•¸ã€é™¤æ•¸ã€å¿…é ˆå’Œé¡Œç›®æ•˜è¿°ä¸€è‡´ï¼Œå¦å‰‡æœƒæç¤ºä½ é‡æ–°ç¢ºèªç®—å¼ã€‚</li>
            <li>ç­”å°æœƒç«‹åˆ»é€²å…¥ä¸‹ä¸€é¡Œï¼›ç­”éŒ¯æœƒé¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆä¸¦ç¹¼çºŒæŒ‘æˆ°ã€‚</li>
            <li>å¯æŒ‰ã€Œæš«åœã€é€²å…¥å…¬å¹³æ¨¡å¼ï¼šé¡Œç›®é®è”½ã€è¼¸å…¥é–å®šï¼ŒæŒ‰ã€Œæ¢å¾©ã€æ‰ç¹¼çºŒã€‚</li>
          </ul>
          <div class="rule-note">å°æé†’ï¼šæŠŠã€Œç¸½é‡ã€ç•¶è¢«é™¤æ•¸ï¼ŒæŠŠã€Œå¹³å‡åˆ†æˆçš„ä»½æ•¸ã€ç•¶é™¤æ•¸ï¼Œé€šå¸¸å°±ä¸æœƒè¿·è·¯ã€‚</div>
        </div>

        <div class="rule-block">
          <div class="rule-h"><i class="fa-solid fa-stopwatch"></i>è¨ˆæ™‚èˆ‡è¨ˆåˆ†</div>
          <ul class="rule-ul">
            <li>è¨ˆæ™‚ï¼šåœ¨é¸å–®å¯é¸ 120s / 90s / 60sï¼Œæ™‚é–“æ­¸é›¶å°±çµæŸæœ¬æ¬¡æŒ‘æˆ°ã€‚</li>
            <li>æ™®é€šï¼šæ¯ç­”å° 1 é¡Œ <b>+10</b> åˆ†ï¼›å›°é›£ï¼šæ¯ç­”å° 1 é¡Œ <b>+15</b> åˆ†ã€‚</li>
            <li>ç­”éŒ¯ï¼šåˆ†æ•¸ <b>-5</b>ï¼ˆæœ€ä½ä¸æœƒå°æ–¼ 0ï¼‰ã€‚</li>
            <li>é€£å° 3 é¡Œä»¥ä¸Šæœƒé¡¯ç¤ºé€£æ“Šæç¤ºï¼ˆåˆ†æ•¸ä¾ç…§æ¨¡å¼ç…§å¸¸ç´¯åŠ ï¼‰ã€‚</li>
          </ul>
          <div class="rule-note">æ’è¡Œæ¦œæœƒè¨˜éŒ„ä½ æœ¬æ¬¡ã€Œå›åˆ°é¸å–®ã€æˆ–ã€Œæ™‚é–“åˆ°ã€çš„åˆ†æ•¸ï¼Œæƒ³åˆ·æ¦œå°±â€¦æ‡‚çš„éƒ½æ‡‚ ğŸ˜</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const levelMeta = {
      1:{ id:"6-1", title:"æ­¥é©Ÿè¿·å®®", tag:"å››ä½æ•¸ Ã· ä¸€ä½æ•¸", storyIcon:"fa-pen-ruler", storyPrefix:"ç³»çµ±åµæ¸¬åˆ° <b>{a}</b> å–®ä½å°åŒ…ï¼Œéœ€åˆ†æµè‡³ <b>{b}</b> å€‹è™•ç†ç¯€é»ã€‚è«‹è¨ˆç®—å–®ä¸€ç¯€é»æ‰¿è¼‰é‡ã€‚" },
      2:{ id:"6-2", title:"åˆ†é…å¾‹å·¥å» ", tag:"äºŒä½æ•¸ Ã· äºŒä½æ•¸", storyIcon:"fa-link", storyPrefix:"æ ¸å¿ƒé »ç‡éœ€æ ¡æº–è‡³ <b>{a}</b>ï¼Œç›®å‰å…±æŒ¯å™¨ç‚º <b>{b}</b>ã€‚è«‹ä¼°è¨ˆéœ€ç–ŠåŠ ä¹‹å€ç‡ã€‚" },
      3:{ id:"6-3", title:"é€£é™¤æŒ‘æˆ°", tag:"ä¸‰ä½æ•¸ Ã· äºŒä½æ•¸", storyIcon:"fa-swords", storyPrefix:"çµæ§‹é«”ç¸½é‡ç‚º <b>{a}</b>ï¼Œæ¯ä¸€å±¤ç´šéœ€å®¹ç´ <b>{b}</b> çµ„æ¨¡çµ„ã€‚è«‹è¨ˆç®—æ¨¡çµ„ç²¾ç´°åº¦ã€‚" },
      4:{ id:"6-4", title:"ç”Ÿæ´»æ‡‰ç”¨å®¶", tag:"10, 100 ä¹‹é™¤æ³•", storyIcon:"fa-cart-shopping", storyPrefix:"åµæ¸¬åˆ° <b>{a}</b> å–®ä½èƒ½ç´šï¼Œå— <b>{b}</b> ä¿‚æ•¸ä½ç§»å½±éŸ¿ã€‚è«‹è¨ˆç®—æœ€çµ‚ä½èƒ½å€¼ã€‚" }
    };

    const appStoryPool = {
      1: [
        "å·¥å» ç”Ÿç”¢ <b>{a}</b> å€‹é›¶ä»¶ï¼Œå¹³å‡åˆ†çµ¦ <b>{b}</b> å€‹ç­ç´šï¼Œæ¯ç­åˆ†åˆ°å¤šå°‘å€‹ï¼Ÿ",
        "ç¹”å¸ƒæ©Ÿå®Œæˆ <b>{a}</b> å…¬åˆ†å¸ƒæ–™ï¼Œå¹³å‡åˆ‡æˆ <b>{b}</b> æ®µï¼Œæ¯æ®µé•·å¤šå°‘å…¬åˆ†ï¼Ÿ",
        "æœè¾²æ¡æ”¶ <b>{a}</b> é¡†æ°´æœï¼Œå¹³å‡è£æˆ <b>{b}</b> ç›’ï¼Œæ¯ç›’å¹¾é¡†ï¼Ÿ",
        "çˆ¸çˆ¸è²·äº† <b>{a}</b> å…ƒçš„ç‰©å“ï¼Œåˆ† <b>{b}</b> æœŸä»˜æ¬¾ï¼Œæ¯æœŸè¦ä»˜å¤šå°‘å…ƒï¼Ÿ"
      ],
      2: [
        "ç­ç´šæœ‰ <b>{a}</b> é¡†ç³–æœï¼Œå¹³å‡åˆ†çµ¦ <b>{b}</b> å€‹äººï¼Œæ¯äººå¹¾é¡†ï¼Ÿ",
        "æ–‡å…·åº—æœ‰ <b>{a}</b> å…ƒï¼Œæ¯æœ¬ç­†è¨˜æœ¬ <b>{b}</b> å…ƒï¼Œå‰›å¥½è²·å®Œï¼Œèƒ½è²·å¹¾æœ¬ï¼Ÿ",
        "è¦é‹ªæ»¿ <b>{a}</b> å…¬å°ºèµ°é“ï¼Œæ¯å¡Šåœ°æ¯¯ <b>{b}</b> å…¬å°ºï¼Œéœ€è¦å¹¾å¡Šï¼Ÿ"
      ],
      3: [
        "é€ ç´™å» ç”Ÿç”¢ <b>{a}</b> å¼µç´™ï¼Œæ¯ <b>{b}</b> å¼µè£ä¸€åŒ…ï¼Œå¯ä»¥è£æˆå¹¾åŒ…ï¼Ÿ",
        "åœ’éŠæœƒæ”¶å…¥ <b>{a}</b> å…ƒï¼Œå¹³å‡åˆ†çµ¦ <b>{b}</b> ä½åŒå­¸ï¼Œæ¯äººå¯å¾—å¤šå°‘å…ƒï¼Ÿ",
        "å€‰åº«æœ‰ <b>{a}</b> ç½é£²æ–™ï¼Œæ¯ç®±è£ <b>{b}</b> ç½ï¼Œå¯ä»¥è£å¹¾ç®±ï¼Ÿ"
      ],
      4: [
        "è³‡æ–™æµ <b>{a}</b> éœ€è¦ä»¥ <b>{b}</b> çš„å€ç‡ç¸®æ”¾ï¼Œè¼¸å‡ºå€¼æ˜¯å¤šå°‘ï¼Ÿ",
        "æŠŠ <b>{a}</b> çš„æ•¸å€¼é™¤ä»¥ <b>{b}</b> å¾Œï¼Œä½å€¼æœƒå¦‚ä½•æ”¹è®Šï¼Ÿè«‹ç®—å‡ºçµæœã€‚"
      ]
    };

    let playerName = "";
    let currentLevel = 1;
    let difficulty = "easy";
    let speed = "slow";
    let currentQuestion = null;
    let correctAnswer = null;
    let score = 0;
    let streak = 0;
    let timer = 90;
    let timerId = null;
    let gameActive = false;
    let paused = false;
    let revealLock = false;

    const rankRecords = [];

    const screenWelcome = document.getElementById("screen-welcome");
    const screenMenu = document.getElementById("screen-menu");
    const screenGame = document.getElementById("screen-game");

    const welcomeNameInput = document.getElementById("welcomeNameInput");
    const welcomeHint = document.getElementById("welcomeHint");
    const goMenuBtn = document.getElementById("goMenuBtn");

    const levelButtons = document.querySelectorAll(".level-btn");
    const startPlayBtn = document.getElementById("startPlayBtn");

    const guessInput = document.getElementById("guessInput");
    const feedbackBox = document.getElementById("feedbackBox");
    const stockFill = document.getElementById("stockFill");
    const pauseBtn = document.getElementById("pauseBtn");
    const timeupText = document.getElementById("timeupText");

    const pauseOverlay = document.getElementById("pauseOverlay");
    const resumeBtn = document.getElementById("resumeBtn");

    const speedChipButtons = document.querySelectorAll("#speedChips .chip-btn");

    const blankAInput = document.getElementById("blankAInput");
    const blankBInput = document.getElementById("blankBInput");

    /* âœ… è¦å‰‡å½ˆçª—äº’å‹•ï¼ˆåªæ–°å¢åŠŸèƒ½ï¼Œä¸å‹•æ—¢æœ‰æµç¨‹ï¼‰ */
    const ruleBtn = document.getElementById("ruleBtn");
    const ruleModal = document.getElementById("ruleModal");
    const ruleCloseBtn = document.getElementById("ruleCloseBtn");

    function openRule(){
      ruleModal.classList.add("active");
      ruleModal.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }
    function closeRule(){
      ruleModal.classList.remove("active");
      ruleModal.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }

    ruleBtn.addEventListener("click", (e) => { e.preventDefault(); openRule(); });
    ruleCloseBtn.addEventListener("click", closeRule);
    ruleModal.addEventListener("click", (e) => { if(e.target === ruleModal) closeRule(); });
    document.addEventListener("keydown", (e) => { if(e.key === "Escape" && ruleModal.classList.contains("active")) closeRule(); });

    function showScreen(name){
      [screenWelcome, screenMenu, screenGame].forEach(s => s.classList.remove("active"));
      document.getElementById(`screen-${name}`).classList.add("active");
      if(name === "menu") renderRank();
    }

    function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function generateQuestion(){
      let a, b;

      if(currentLevel === 1) {
        b = randInt(2,9);
        a = b * randInt(200, 999);
      }
      else if(currentLevel === 2) {
        b = randInt(11,25);
        a = b * randInt(2, 9);
      }
      else if(currentLevel === 3) {
        b = randInt(11,40);
        a = b * randInt(5, 24);
      }
      else {
        let base = randInt(12, 99);
        let za = randInt(2, 4);
        let zb = randInt(1, za-1);
        a = base * Math.pow(10, za);
        b = Math.pow(10, zb);
      }

      return {a, b};
    }

    function renderRank(){
      const list = document.getElementById("rankList");
      list.innerHTML = "";

      if(rankRecords.length === 0){
        list.innerHTML = `<li><span>æš«ç„¡ç´€éŒ„ï¼Œå¿«ä¾†æŒ‘æˆ°ï¼</span><span>---</span></li>`;
        return;
      }

      rankRecords
        .slice()
        .sort((a,b) => b.score - a.score)
        .slice(0, 8)
        .forEach((r, i) => {
          let rankLabel = `ç¬¬ ${i+1} å`;
          if(i === 0) rankLabel = `ğŸ¥‡ ç¬¬ä¸€å`;
          if(i === 1) rankLabel = `ğŸ¥ˆ ç¬¬äºŒå`;
          if(i === 2) rankLabel = `ğŸ¥‰ ç¬¬ä¸‰å`;

          const li = document.createElement("li");
          li.innerHTML = `<span>${rankLabel}ï½œ${r.name}</span><span>${r.score}</span>`;
          list.appendChild(li);
        });
    }

    function finalizeRun(reasonText){
      if(playerName){
        rankRecords.push({
          name: playerName,
          score: score,
          ts: Date.now(),
          level: currentLevel,
          diff: difficulty,
          speed: speed
        });
        renderRank();
      }
      if(reasonText) timeupText.textContent = reasonText;
    }

    function setPauseOverlay(on){
      pauseOverlay.classList.toggle("active", on);
      pauseOverlay.setAttribute("aria-hidden", on ? "false" : "true");

      guessInput.disabled = on;
      blankAInput.disabled = on;
      blankBInput.disabled = on;

      document.getElementById("checkBtn").disabled = on;
      document.getElementById("minusBtn").disabled = on;
      document.getElementById("plusBtn").disabled = on;
    }

    function clearFormulaInputs(){
      blankAInput.value = "";
      blankBInput.value = "";
    }

    function renderQuestion(){
      revealLock = false;
      currentQuestion = generateQuestion();
      correctAnswer = currentQuestion.a / currentQuestion.b;

      const meta = levelMeta[currentLevel];
      const useApp = Math.random() < 0.55;
      const storyTpl = useApp ? pick(appStoryPool[currentLevel]) : meta.storyPrefix;

      document.getElementById("storyText").innerHTML = storyTpl.replaceAll("{a}", currentQuestion.a).replaceAll("{b}", currentQuestion.b);
      document.getElementById("storyIcon").innerHTML = `<i class="fa-solid ${meta.storyIcon}"></i>`;
      document.getElementById("gameLevelTitle").textContent = meta.title;
      document.getElementById("gameLevelTag").textContent = meta.tag;

      document.getElementById("exprMain").textContent = `${currentQuestion.a} Ã· ${currentQuestion.b} = ?`;

      clearFormulaInputs();

      stockFill.style.width = "100%";
      document.getElementById("stockText").textContent = "100%";
      guessInput.value = "";
      feedbackBox.innerHTML = "";
      timeupText.textContent = "";

      if(paused) setPauseOverlay(true);
    }

    function startTimer(){
      if(timerId) clearInterval(timerId);
      timer = speed === "slow" ? 120 : (speed === "normal" ? 90 : 60);
      document.getElementById("gameTimerText").textContent = `${timer}s`;

      timerId = setInterval(() => {
        if(paused || !gameActive) return;
        timer--;
        document.getElementById("gameTimerText").textContent = `${timer}s`;
        if(timer <= 0) {
          gameActive = false;
          clearInterval(timerId);
          finalizeRun("æ™‚é–“åˆ°ï¼å›åˆ°åŸºåœ°å†æŒ‘æˆ°ä¸€æ¬¡å§ã€‚");
        }
      }, 1000);
    }

    function updateMenuSummary(){
      const lv = levelMeta[currentLevel];
      const diffName = difficulty === "hard" ? "å›°é›£ï¼ˆåˆ†æ•¸x1.5ï¼‰" : "æ™®é€š";
      const spdName = speed === "slow" ? "120s" : (speed === "normal" ? "90s" : "60s");
      document.getElementById("menuSummary").textContent = `ç›®å‰ï¼š${lv.title}ï½œ${diffName}ï½œ${spdName}`;
    }

    function revealThenNext(html, isCorrect){
      if(revealLock) return;
      revealLock = true;

      feedbackBox.innerHTML = html;

      if(isCorrect){
        stockFill.style.width = "0%";
        document.getElementById("stockText").textContent = "0%";
      }

      setTimeout(() => {
        if(!gameActive) { revealLock = false; return; }
        if(paused) { revealLock = false; return; }
        renderQuestion();
      }, 1100);
    }

    function checkFormulaFilledCorrect(){
      const aVal = parseInt(blankAInput.value);
      const bVal = parseInt(blankBInput.value);

      if(isNaN(aVal) || isNaN(bVal)){
        feedbackBox.innerHTML = `<span class="bad">è«‹å…ˆè¼¸å…¥è¢«é™¤æ•¸èˆ‡é™¤æ•¸ã€‚</span>`;
        return false;
      }

      if(aVal !== currentQuestion.a || bVal !== currentQuestion.b){
        feedbackBox.innerHTML =
          `<span class="bad">ç®—å¼ä¸å¤ªå°</span>ã€€<span class="ans">æç¤ºï¼šæŠŠã€Œç¸½é‡ã€ç•¶è¢«é™¤æ•¸ï¼ŒæŠŠã€Œå¹³å‡åˆ†æˆçš„ä»½æ•¸ã€ç•¶é™¤æ•¸ã€‚</span>`;
        return false;
      }

      return true;
    }

    blankAInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter"){ e.preventDefault(); blankBInput.focus(); }
    });
    blankBInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter"){ e.preventDefault(); guessInput.focus(); }
    });

    goMenuBtn.onclick = () => {
      playerName = welcomeNameInput.value.trim();
      if(!playerName) { welcomeHint.textContent = "è«‹å…ˆè¼¸å…¥åå­—"; return; }
      welcomeHint.textContent = "";
      document.getElementById("playerNameTitle").textContent = playerName;
      showScreen("menu");
      updateMenuSummary();
      renderRank();
    };

    levelButtons.forEach(btn => {
      btn.onclick = () => {
        levelButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentLevel = parseInt(btn.dataset.level);
        updateMenuSummary();
      };
    });

    document.getElementById("diffEasy").onclick = () => {
      difficulty = "easy";
      document.getElementById("diffEasy").classList.add("active");
      document.getElementById("diffHard").classList.remove("active");
      updateMenuSummary();
    };
    document.getElementById("diffHard").onclick = () => {
      difficulty = "hard";
      document.getElementById("diffHard").classList.add("active");
      document.getElementById("diffEasy").classList.remove("active");
      updateMenuSummary();
    };

    speedChipButtons.forEach(c => c.onclick = () => {
      speedChipButtons.forEach(x => x.classList.remove("active"));
      c.classList.add("active");
      speed = c.dataset.speed;
      updateMenuSummary();
    });

    startPlayBtn.onclick = () => {
      score = 0;
      streak = 0;
      paused = false;
      setPauseOverlay(false);
      pauseBtn.textContent = "æš«åœ";
      timeupText.textContent = "";
      revealLock = false;

      gameActive = true;
      document.getElementById("gameScoreText").textContent = "0";
      showScreen("game");
      renderQuestion();
      startTimer();
    };

    document.getElementById("checkBtn").onclick = () => {
      if(!gameActive || paused) return;
      if(revealLock) return;

      if(!checkFormulaFilledCorrect()) return;

      const val = parseInt(guessInput.value);
      if(isNaN(val)) return;

      if(val === correctAnswer) {
        const base = (difficulty === "hard") ? 15 : 10;
        score += base;
        streak += 1;

        const msg = (streak >= 3)
          ? `å¤ªçŒ›äº†ï¼é€£å° ${streak} é¡Œ ğŸ”¥ +${base} åˆ†`
          : `æ­£ç¢ºï¼+${base} åˆ†`;

        document.getElementById("gameScoreText").textContent = score;
        revealThenNext(`<span class="good">${msg}</span>`, true);

      } else {
        streak = 0;
        score = Math.max(0, score - 5);
        document.getElementById("gameScoreText").textContent = score;

        let ratio = Math.abs(val - correctAnswer) / Math.max(1, correctAnswer);
        stockFill.style.width = `${Math.min(100, ratio * 100)}%`;
        document.getElementById("stockText").textContent = `${Math.round(ratio*100)}%`;

        revealThenNext(
          `<span class="bad">ç­”éŒ¯äº†</span>ã€€<span class="ans">æ­£ç¢ºç­”æ¡ˆï¼š${correctAnswer}</span>`,
          false
        );
      }
    };

    document.getElementById("minusBtn").onclick = () => {
      if(paused) return;
      if(guessInput.value) guessInput.value = parseInt(guessInput.value) - 1;
      else guessInput.value = -1;
    };
    document.getElementById("plusBtn").onclick = () => {
      if(paused) return;
      guessInput.value = (parseInt(guessInput.value) || 0) + 1;
    };

    document.getElementById("backMenuBtn").onclick = () => {
      gameActive = false;
      clearInterval(timerId);
      finalizeRun("å·²è¿”å›é¸å–®ã€‚");
      showScreen("menu");
      updateMenuSummary();
    };

    document.getElementById("retryTopBtn").onclick = () => { startPlayBtn.onclick(); };

    pauseBtn.onclick = () => {
      if(!gameActive) return;
      paused = !paused;
      pauseBtn.textContent = paused ? "æ¢å¾©" : "æš«åœ";
      setPauseOverlay(paused);
    };
    resumeBtn.onclick = () => {
      if(!gameActive) return;
      paused = false;
      pauseBtn.textContent = "æš«åœ";
      setPauseOverlay(false);
    };

    guessInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter") document.getElementById("checkBtn").click();
    });

    updateMenuSummary();
    renderRank();
  </script>
</body>
</html>







